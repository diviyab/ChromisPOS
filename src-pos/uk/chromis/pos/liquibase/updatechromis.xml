<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog

    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">


    <property name="boolean.type" value="boolean" dbms="derby, postgresql, hypersql, hsqldb"/>
    <property name="boolean.type" value="bit" dbms="mysql"/>
    <property name="boolean.type" value="numeric(1)" dbms="oracle"/>

    <property name="blob.type" value="blob" dbms="oracle, derby, hypersql, hsqldb"/>
    <property name="blob.type" value="bytea" dbms="postgresql"/>
    <property name="blob.type" value="mediumblob" dbms="mysql"/>

    <include file="uk/chromis/pos/liquibase/dbpermissions.xml"/>  
 
    
    <!-- ***************************************************************************************** --> 
    <!-- ***************************************************************************************** --> 
    <!-- Using the liquibase scripts.
        
         The liquibase script has now been broken down into sections. There are some sections that
         remain as they are, due to the order of historic processing. and errors that would be
         created by modifying these.
         If the size of the script decome unmanagablem additional scripts will be created.
        
         When there is a need to add any new changes into the liquibase scripts.
         DO NOT, change an existing changeset, this will change the MD5 signature for the change
         and will then prevent the scrip from running throwing a liquibase error.
    
    Please read the comments before each section -->
    
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->    
    <!-- Need to enure that all columns are present before attempting to refactor for deriby
    Once refactored all columns will be added with new format
    DO NOT MOVE OR ADD TO THIS SECTION -->
    <changeSet author="Chromis POS" id="Add PrintkB if not found" dbms="postgresql, hypersql, hsqldb">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="PRINTKB" tableName="PRODUCTS"/>
            </not>
        </preConditions>

        <addColumn tableName="PRODUCTS">
            <column name="PRINTKB" type="${boolean.type}" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>                                                   
        </addColumn>                     
    </changeSet> 

    <changeSet author="Chromis POS" id="Add PrintkB if not found m" dbms="mysql, oracle">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="PRINTKB" tableName="PRODUCTS"/>
            </not>
        </preConditions>

        <addColumn tableName="PRODUCTS">
            <column name="PRINTKB" type="${boolean.type}" defaultValueNumeric="1" >
                <constraints nullable="false"/>
            </column>                                                   
        </addColumn>                     
    </changeSet> 

    <changeSet author="Chromis POS" id="Add PrintkB if not found d" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="PRINTKB" tableName="PRODUCTS"/>
            </not>
        </preConditions>

        <addColumn tableName="PRODUCTS">
            <column name="PRINTKB" type="SMALLINT" defaultValueNumeric="1" >
                <constraints nullable="false"/>
            </column>                                                   
        </addColumn>                     
    </changeSet> 

    <changeSet author="Chromis POS" id="Add SENDSTATUS if not found" dbms="postgresql, hypersql, hsqldb">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="SENDSTATUS" tableName="PRODUCTS"/>
            </not>
        </preConditions>

        <addColumn tableName="PRODUCTS">
            <column name="SENDSTATUS" type="${boolean.type}" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>                                                   
        </addColumn>                     
    </changeSet> 

    <changeSet author="Chromis POS" id="Add SENDSTATUS if not found m" dbms="mysql, oracle">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="SENDSTATUS" tableName="PRODUCTS"/>
            </not>
        </preConditions>

        <addColumn tableName="PRODUCTS">
            <column name="SENDSTATUS" type="${boolean.type}" defaultValueNumeric="1" >
                <constraints nullable="false"/>
            </column>                                                   
        </addColumn>                     
    </changeSet> 

    <changeSet author="Chromis POS" id="Add SENDSTATUS if not found d" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="SENDSTATUS" tableName="PRODUCTS"/>
            </not>
        </preConditions>

        <addColumn tableName="PRODUCTS">
            <column name="SENDSTATUS" type="SMALLINT" defaultValueNumeric="1" >
                <constraints nullable="false"/>
            </column>                                                   
        </addColumn>                     
    </changeSet>
    <!-- End of refactoring preperation -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->    
    <!-- Refactors derby database to use update driver for boolean 
    Any columns that used 'int' will be converted to use true/false.
    DO NOT CHANGE THIS SECTION -->    
    <changeSet author="Chromis POS" id="Refactor People table" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM DATABASECHANGELOG WHERE ID='derby10.10.20'</sqlCheck>  
        </preConditions>  
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="VISIBLE"
            tableName="PEOPLE"/>
  
        <addColumn tableName="PEOPLE">
            <column name="VISIBLE" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PEOPLE SET VISIBLE='TRUE' WHERE JDL_TMP=1;
            UPDATE PEOPLE SET VISIBLE='FALSE' WHERE JDL_TMP=0
        </sql>
        
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PEOPLE"/>
    </changeSet>  
    
    <changeSet author="Chromis POS" id="Refactor Breaks table" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM DATABASECHANGELOG WHERE ID='derby10.10.20'</sqlCheck>  
        </preConditions> 
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="VISIBLE"
            tableName="BREAKS"/>
  
        <addColumn tableName="BREAKS">
            <column name="VISIBLE" type="boolean"/>
        </addColumn>
        
        <sql>
            UPDATE BREAKS SET VISIBLE='TRUE' WHERE JDL_TMP=1;
            UPDATE BREAKS SET VISIBLE='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="BREAKS"/>
    </changeSet>            
      
    <changeSet author="Chromis POS" id="Refactor CUSTOMER table" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM DATABASECHANGELOG WHERE ID='derby10.10.20'</sqlCheck>  
        </preConditions> 
    
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="VISIBLE"
            tableName="CUSTOMERS"/>
  
        <addColumn tableName="CUSTOMERS">
            <column name="VISIBLE" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE CUSTOMERS SET VISIBLE='TRUE' WHERE JDL_TMP=1;
            UPDATE CUSTOMERS SET VISIBLE='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="CUSTOMERS"/>
    </changeSet>      
        
    <changeSet author="Chromis POS" id="Refactor Moorers table" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM DATABASECHANGELOG WHERE ID='derby10.10.20'</sqlCheck>  
        </preConditions>        

        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="POWER"
            tableName="MOORERS"/>
  
        <addColumn tableName="MOORERS">
            <column name="POWER" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE MOORERS SET POWER='TRUE' WHERE JDL_TMP=1;
            UPDATE MOORERS SET POWER='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="MOORERS"/>
    </changeSet>      
        
    <changeSet author="Chromis POS" id="Refactor Places table" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM DATABASECHANGELOG WHERE ID='derby10.10.20'</sqlCheck>  
        </preConditions>   

        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="TABLEMOVED"
            tableName="PLACES"/>
  
        <addColumn tableName="PLACES">
            <column name="TABLEMOVED" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PLACES SET TABLEMOVED='TRUE' WHERE JDL_TMP=1;
            UPDATE PLACES SET TABLEMOVED='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PLACES"/>
    </changeSet>        
        
    <changeSet author="Chromis POS" id="Refactor Catergories table" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM DATABASECHANGELOG WHERE ID='derby10.10.20'</sqlCheck>  
        </preConditions>    

        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="CATSHOWNAME"
            tableName="CATEGORIES"/>
  
        <addColumn tableName="CATEGORIES">
            <column name="CATSHOWNAME" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE CATEGORIES SET CATSHOWNAME='TRUE' WHERE JDL_TMP=1;
            UPDATE CATEGORIES SET CATSHOWNAME='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="CATEGORIES"/>
    </changeSet>         
        
    <changeSet author="Chromis POS" id="Refactor Taxes table" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM DATABASECHANGELOG WHERE ID='derby10.10.20'</sqlCheck>  
        </preConditions>     

        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="RATECASCADE"
            tableName="TAXES"/>
  
        <addColumn tableName="TAXES">
            <column name="RATECASCADE" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE TAXES SET RATECASCADE='TRUE' WHERE JDL_TMP=1;
            UPDATE TAXES SET RATECASCADE='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="TAXES"/>
    </changeSet>         
        
    <changeSet author="Chromis POS" id="Refactor Reservations table" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM DATABASECHANGELOG WHERE ID='derby10.10.20'</sqlCheck>  
        </preConditions>    

        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="ISDONE"
            tableName="RESERVATIONS"/>
  
        <addColumn tableName="RESERVATIONS">
            <column name="ISDONE" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE RESERVATIONS SET ISDONE='TRUE' WHERE JDL_TMP=1;
            UPDATE RESERVATIONS SET ISDONE='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="RESERVATIONS"/>
    </changeSet>         
        
    
    <changeSet author="Chromis POS" id="Refactor Products table" dbms="derby">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(*) FROM DATABASECHANGELOG WHERE ID='derby10.10.20'</sqlCheck>  
        </preConditions>  

        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="ISCOM"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="ISCOM" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET ISCOM='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET ISCOM='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="ISSCALE"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="ISSCALE" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET ISSCALE='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET ISSCALE='FALSE' WHERE JDL_TMP=0    
        </sql>                    
        
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="ISKITCHEN"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="ISKITCHEN" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET ISKITCHEN='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET ISKITCHEN='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>        
  
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="PRINTKB"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="PRINTKB" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET PRINTKB='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET PRINTKB='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>      
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="SENDSTATUS"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="SENDSTATUS" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET SENDSTATUS='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET SENDSTATUS='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>       
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="ISSERVICE"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="ISSERVICE" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET ISSERVICE='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET ISSERVICE='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>        
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="ISVERPATRIB"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="ISVERPATRIB" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET ISVERPATRIB='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET ISVERPATRIB='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>        
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="ISVPRICE"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="ISVPRICE" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET ISVPRICE='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET ISVPRICE='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>       
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="WARRANTY"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="WARRANTY" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET WARRANTY='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET WARRANTY='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>        
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="CANDISCOUNT"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="CANDISCOUNT" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET CANDISCOUNT='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET CANDISCOUNT='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>         
        
        <renameColumn 
            newColumnName="JDL_TMP"
            oldColumnName="ALWAYSAVAILABLE"
            tableName="PRODUCTS"/>
  
        <addColumn tableName="PRODUCTS">
            <column name="ALWAYSAVAILABLE" type="boolean"/>
        </addColumn>
        <sql>
            UPDATE PRODUCTS SET ALWAYSAVAILABLE='TRUE' WHERE JDL_TMP=1;
            UPDATE PRODUCTS SET ALWAYSAVAILABLE='FALSE' WHERE JDL_TMP=0    
        </sql>  
              
        <dropColumn 
            columnName="JDL_TMP"
            tableName="PRODUCTS"/>         

        <sql>
            INSERT INTO DATABASECHANGELOG (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, EXECTYPE, MD5SUM, DESCRIPTION, LIQUIBASE) 
            VALUES (
            'derby10.10.20',
            'Chromis POS', 
            'uk/chromis/pos/liquibase/udpdatecreatedb.xml', 
            '2015-10-23 22:43:33.487',
            0,
            'EXECUTED',
            '7:d41d8cd98f00b204e9800998ecf8427e',
            'empty',                       
            '3.5.0-Chromis Mod')                
        </sql>
    </changeSet>     
    <!-- End of  Derby refactoring -->                 
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->    
    <!-- Add any new tables required in this section -->
    <changeSet author="Chromis POS" id="Create StockChanges Table">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="STOCKCHANGES"/>
            </not>
        </preConditions>

        <createTable tableName="STOCKCHANGES">
            <column name="ID" type="varchar(50)">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="LOCATION" type="varchar(255)"/>                
            <column name="USERNAME" type="varchar(50)"/>           
            <column name="UPLOADTIME" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP"/>
            <column name="CHANGES_PRODUCT" type="varchar(255)"/>
            <column name="CHANGES_TYPE" type="int"/>
            <column name="CHANGES_PROCESSED" type="int"/>
            <column name="CHANGES_FIELD" type="varchar(50)"/>
            <column name="CHANGES_TEXTVALUE" type="varchar(255)"/> 
            <column name="CHANGES_BLOBVALUE" type="${blob.type}"/>                                    
        </createTable>       
    </changeSet>   
  

    <changeSet author="Chromis POS" id="Create Voucher Table">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="VOUCHERS"/>
            </not>
        </preConditions>

        <createTable tableName="VOUCHERS">
            <column name="VOUCHER" type="varchar(50)">
                <constraints primaryKey="true" nullable="false"/>
            </column>           
            <column name="SOLDDATE" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP"/>
            <column name="REDEEMDATE" type="timestamp" />            
            <column name="SOLDTICKETID" type="varchar(50)"/>
            <column name="REDEEMTICKETID" type="varchar(50)"/>                                    
        </createTable>       
    </changeSet>
    
    <changeSet author="Chromis POS" id="Create Orders Table">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="ORDERS"/>
            </not>
        </preConditions>

        <createTable tableName="ORDERS">
            <column name="ID" type="varchar(50)">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="ORDERID" type="varchar(50)"/>                
            <column name="QTY" type="int"/>           
            <column name="DETAILS" type="varchar(255)"/>
            <column name="ATTRIBUTES" type="varchar(255)"/>
            <column name="NOTES" type="varchar(255)"/>
            <column name="TICKETID" type="varchar(255)"/>
            <column name="ORDERTIME" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP"/>
            <column name="DISPLAYID" type="int"/>                                    
        </createTable>                         
    </changeSet> 
    
    <changeSet author="Chromis Pos" id="Create TICKETSNUM Sequence INVOICE" dbms="postgresql, hypersql, hsqldb">  
        <sql>CREATE SEQUENCE TICKETSNUM_INVOICE START WITH 1</sql>  
    </changeSet>  

    <changeSet author="Chromis Pos" id="Create TICKETSNUM Sequence INVOICE mysql" dbms="mysql">
        <sql>CREATE TABLE TICKETSNUM_INVOICE (ID INTEGER DEFAULT 0 NOT NULL) ENGINE=InnoDB DEFAULT CHARSET=utf8;
            INSERT INTO TICKETSNUM_INVOICE VALUES(1)</sql>
    </changeSet>

    <changeSet author="Chromis Pos" id="Create TICKETSNUM Sequence INVOICE oracle" dbms="oracle">
        <sql>CREATE TABLE TICKETSNUM_INVOICE (ID INTEGER DEFAULT 0 NOT NULL);
            INSERT INTO TICKETSNUM_INVOICE VALUES(1)</sql>
    </changeSet>

    <changeSet author="Chromis Pos" id="CCreate TICKETSNUM Sequence INVOICE  derby" dbms="derby">
        <sql>CREATE TABLE TICKETSNUM_INVOICE (ID INTEGER GENERATED ALWAYS AS IDENTITY (START WITH 1));
            INSERT INTO TICKETSNUM_INVOICE VALUES (DEFAULT)</sql>
    </changeSet>
    <!-- End of new tables sections -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->   
    <!-- Add any new columns required in this section --> 
    <changeSet author="Chromis POS" id="Add refund qty Ticketlines Table">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="REFUNDQTY" tableName="TICKETLINES"/>
            </not>
        </preConditions>

        <addColumn tableName="TICKETLINES">
            <column name="REFUNDQTY" type="double precision" defaultValueNumeric="0.0"/>                                                   
        </addColumn>                         
    </changeSet>
    
    <changeSet author="Chromis POS" id="check for Stockunits column">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="STOCKUNITS" tableName="PRODUCTS"/>
            </not>
        </preConditions>     
               
        <addColumn tableName="PRODUCTS">
            <column name="STOCKUNITS" type="double precision" defaultValueNumeric="0"/>
        </addColumn>
    </changeSet>

    <changeSet author="Chromis POS" id="Add Pack Products details p" dbms="postgresql, hypersql, hsqldb">    
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="ISPACK" tableName="PRODUCTS"/>
            </not>
        </preConditions>   

        <addColumn tableName="PRODUCTS">
            <column name="ISPACK" type="${boolean.type}" defaultValueBoolean="false" >
                <constraints nullable="false"/>
            </column>
            <column name="PACKQUANTITY" type="double precision"/>
            <column name="PACKPRODUCT" type="varchar(255)"/>
        </addColumn>
    
        <addForeignKeyConstraint baseColumnNames="PACKPRODUCT"
                                 constraintName ="PRODUCTS_PACKPRODUCT_FK"
                                 referencedColumnNames = "ID"
                                 baseTableName="PRODUCTS"
                                 referencedTableName="PRODUCTS"/>    
    </changeSet>           
  
    <changeSet author="Chromis POS" id="Add Pack Products details m" dbms="mysql, oracle">    
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="ISPACK" tableName="PRODUCTS"/>
            </not>
        </preConditions>   
           
        <addColumn tableName="PRODUCTS">
            <column name="ISPACK" type="${boolean.type}" defaultValueNumeric="1" >
                <constraints nullable="false"/>
            </column>
            <column name="PACKQUANTITY" type="double precision"/>
            <column name="PACKPRODUCT" type="varchar(255)"/>
        </addColumn>        
        
        <addForeignKeyConstraint baseColumnNames="PACKPRODUCT"
                                 constraintName ="PRODUCTS_PACKPRODUCT_FK"
                                 referencedColumnNames = "ID"
                                 baseTableName="PRODUCTS"
                                 referencedTableName="PRODUCTS"/>  
    </changeSet>        
  
    <changeSet author="Chromis POS" id="Add Pack Products details d" dbms="derby">    
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="ISPACK" tableName="PRODUCTS"/>
            </not>
        </preConditions> 
    
        <addColumn tableName="PRODUCTS">
            <column name="ISPACK" type="${boolean.type}" defaultValueBoolean="false" >
                <constraints nullable="false"/>
            </column>
            <column name="PACKQUANTITY" type="double precision"/>
            <column name="PACKPRODUCT" type="varchar(255)"/>
        </addColumn>
    </changeSet>
    
    <changeSet author="Chromis POS" id="Add Auxiliary Column to Orders Table">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="AUXILIARY" tableName="ORDERS"/>
            </not>
        </preConditions>

        <addColumn tableName="ORDERS">
            <column name="AUXILIARY" type="int"/>                                                   
        </addColumn>                         
    </changeSet>
    
    <changeSet author="Chromis POS" id="check for catorder column in categories table">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists columnName="CATORDER" tableName="CATEGORIES" />
            </not>
        </preConditions>     
               
        <addColumn tableName="CATEGORIES">
            <column name="CATORDER" type="integer"/>
        </addColumn>        
    </changeSet>
    <!-- End of new columns sections -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->              
    <!-- Add any new resource changesets to this section --> 
    <changeSet author="Chromis POS" id="Insert into RESOURCES Table">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(1) FROM RESOURCES WHERE ID='63'</sqlCheck>
        </preConditions>

        <insert tableName="RESOURCES">
            <column name="ID" value="63"/>
            <column name="NAME" value="Printer.TicketRefundPreview"/>
            <column name="RESTYPE" valueNumeric="0"/>
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/templates/Printer.TicketRefundPreview.xml"/>
        </insert>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    </changeSet>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
        
    
    <changeSet author="Chromis POS" id="Add reportlogo to resources">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(1) FROM RESOURCES WHERE NAME = 'img.reportlogo'</sqlCheck>
        </preConditions> 
        
        <insert tableName="RESOURCES">
            <column name="ID" value="62"/>
            <column name="NAME" value="img.reportlogo"/>
            <column name="RESTYPE" valueNumeric="1"/>
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/templates/img.reportlogo.png"/>
        </insert>
    </changeSet> 
    
    <changeSet author="Chromis POS" id="Add sql.ActionStockChanges to resources">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(1) FROM RESOURCES WHERE NAME = 'sql.ActionStockChanges'</sqlCheck>
        </preConditions> 
        
        <insert tableName="RESOURCES">
            <column name="ID" value="64"/>
            <column name="NAME" value="sql.ActionStockChanges"/>
            <column name="RESTYPE" valueNumeric="0"/>
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/templates/sql.ActionStockChanges.txt"/>
        </insert>
    </changeSet> 
    
    <changeSet author="Chromis POS" id="update sql.ActionStockChanges to resources">        
        <update tableName="RESOURCES">
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/templates/sql.ActionStockChanges.txt"/>  
            <where>NAME='sql.ActionStockChanges'</where>      
        </update> 
    </changeSet>                     
                                                       
    <changeSet author="Chromis POS" id="update to to new menu for roles">    
        <update tableName="RESOURCES">
            <column name="CONTENT" valueBlobResource="/uk/chromis/pos/templates/Menu.Root.txt"/>  
            <where>NAME='Menu.Root'</where>      
        </update>               
    </changeSet>
    <!-- End of resource changeset section   -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->              
    <!-- Add any new dbpermission changesets to this section -->   
    <changeSet author="Chromis POS" id="Add Pack Products permissions "> 
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(0) FROM DBPERMISSIONS WHERE DISPLAYNAME='##label.displayname117'  </sqlCheck>
        </preConditions>
              
        <insert tableName="DBPERMISSIONS">		
            <column name="CLASSNAME" value="/uk/chromis/reports/inventoryreorder.bs"/>
            <column name="SECTION" value="##label.sectionstock"/>
            <column name="DISPLAYNAME" value="##label.displayname117"/>
            <column name="DESCRIPTION" value="##label.description117"/>
        </insert>
        
        <insert tableName="DBPERMISSIONS">		
            <column name="CLASSNAME" value="uk.chromis.pos.inventory.ProductPacksPanel"/>
            <column name="SECTION" value="##label.sectionstock"/>
            <column name="DISPLAYNAME" value="##label.displayname118"/>
            <column name="DESCRIPTION" value="##label.description118"/>
        </insert>		         
    </changeSet>
    
    <changeSet author="Chromis POS" id="Add StockChanges to permissions">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">SELECT COUNT(1) FROM DBPERMISSIONS WHERE DESCRIPTION = '##label.description119'</sqlCheck>
        </preConditions>   
            
        <insert tableName="DBPERMISSIONS">		
            <column name="CLASSNAME" value="uk.chromis.pos.imports.StockChangesPanel"/>
            <column name="SECTION" value="##label.sectiontools"/>
            <column name="DISPLAYNAME" value="##label.displayname119"/>
            <column name="DESCRIPTION" value="##label.description119"/>
        </insert>
        		
        <insert tableName="DBPERMISSIONS">		
            <column name="CLASSNAME" value="/uk/chromis/reports/stockchanges.bs"/>
            <column name="SECTION" value="##label.sectiontools"/>
            <column name="DISPLAYNAME" value="##label.displayname120"/>
            <column name="DESCRIPTION" value="##label.description120"/>
        </insert>		                 
    </changeSet>    
    
    <changeSet author="Chromis POS" id="Add button.refundeditsale to permissions">        
        <insert tableName="DBPERMISSIONS">
            <column name="CLASSNAME" value="button.refundeditsale"/>
            <column name="SECTION" value="##label.sectionbuttons"/>
            <column name="DISPLAYNAME" value="##label.displayname121"/>
            <column name="DESCRIPTION" value="##label.description121"/>
        </insert>
    </changeSet>
    <!-- End of dbpermissions changeset section   -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->   
    <!-- Mysql change to InnoDB if required 
         All new tables should be followed by the InnDB change for that table.         
    -->
    <changeSet author="Chromis POS" id="change Mysql tables to InnoDB (if required)" dbms="mysql">            
        <sql>ALTER TABLE APPLICATIONS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE ATTRIBUTE ENGINE=InnoDB</sql>
        <sql>ALTER TABLE ATTRIBUTEINSTANCE ENGINE=InnoDB</sql>
        <sql>ALTER TABLE ATTRIBUTESET ENGINE=InnoDB</sql>
        <sql>ALTER TABLE ATTRIBUTESETINSTANCE ENGINE=InnoDB</sql>
        <sql>ALTER TABLE ATTRIBUTEUSE ENGINE=InnoDB</sql>
        <sql>ALTER TABLE ATTRIBUTEVALUE ENGINE=InnoDB</sql>
        <sql>ALTER TABLE BREAKS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE CATEGORIES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE CLOSEDCASH ENGINE=InnoDB</sql>
        <sql>ALTER TABLE CSVIMPORT ENGINE=InnoDB</sql>
        <sql>ALTER TABLE CUSTOMERS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE DATABASECHANGELOG ENGINE=InnoDB</sql>
        <sql>ALTER TABLE DATABASECHANGELOGLOCK ENGINE=InnoDB</sql>
        <sql>ALTER TABLE DBPERMISSIONS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE DRAWEROPENED ENGINE=InnoDB</sql>
        <sql>ALTER TABLE FLOORS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE LEAVES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE LINEREMOVED ENGINE=InnoDB</sql>
        <sql>ALTER TABLE LOCATIONS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE MOORERS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE PAYMENTS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE PEOPLE ENGINE=InnoDB</sql>
        <sql>ALTER TABLE PICKUP_NUMBER ENGINE=InnoDB</sql>
        <sql>ALTER TABLE PLACES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE PRODUCTS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE PRODUCTS_CAT ENGINE=InnoDB</sql>
        <sql>ALTER TABLE PRODUCTS_COM ENGINE=InnoDB</sql>
        <sql>ALTER TABLE RECEIPTS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE RESERVATION_CUSTOMERS	 ENGINE=InnoDB</sql>
        <sql>ALTER TABLE RESERVATIONS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE RESOURCES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE ROLES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE SHAREDTICKETS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE SHIFT_BREAKS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE SHIFTS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE STOCKCURRENT ENGINE=InnoDB</sql>
        <sql>ALTER TABLE STOCKDIARY ENGINE=InnoDB</sql>
        <sql>ALTER TABLE STOCKLEVEL ENGINE=InnoDB</sql>
        <sql>ALTER TABLE TAXCATEGORIES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE TAXCUSTCATEGORIES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE TAXES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE TAXLINES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE THIRDPARTIES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE TICKETLINES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE TICKETS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE TICKETSNUM ENGINE=InnoDB</sql>
        <sql>ALTER TABLE TICKETSNUM_PAYMENT ENGINE=InnoDB</sql>
        <sql>ALTER TABLE TICKETSNUM_REFUND ENGINE=InnoDB</sql>      
    </changeSet>    
    
    <changeSet author="Chromis POS" id="change Mysql Voucher-Orders-Stockchanges table to InnoDB (if required)" dbms="mysql">            
        <sql>ALTER TABLE STOCKCHANGES ENGINE=InnoDB</sql>
        <sql>ALTER TABLE ORDERS ENGINE=InnoDB</sql>
        <sql>ALTER TABLE VOUCHERS ENGINE=InnoDB</sql>
    </changeSet> 
    <!-- End of InnoDB section --> 
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->
    <!-- ***************************************************************************************** -->  
    <!-- Update this section with the latest version number -->
    <!-- Remember to always change the ID details as well -->    
    <changeSet author="Chromis POS" id="Update to v0.53.3">    
        <update tableName="APPLICATIONS">
            <column name="VERSION" value="0.53.3"/>          
        </update>               
    </changeSet> 
    <!-- ***************************************************************************************** -->      
</databaseChangeLog>

